version: '3'

services:

#  gandi_dns:
#    image: anthonymobile/gandi-live-dns
#    restart: always
#    environment:
#      - GANDI_API_KEY=$GANDI_API_KEY
#      - GANDI_DOMAIN=$GANDI_DOMAIN
#      - GANDI_SUBDOMAINS=$GANDI_SUBDOMAINS

  #todo fix uid issue, unable to delete old puddles (on cornellbus)
  acquire:
    restart: always
    build:
      context: .
      dockerfile: ./build/acquire/Dockerfile
    volumes:
      - ./data:/app/data
    command:
      python3 /app/acquire.py

  api:
    restart: always
    build:
      context: .
      dockerfile: ./build/api/Dockerfile
    volumes:
      - ./data:/app/data
    ports:
      - 80:80
    command:
      uvicorn --host=0.0.0.0 --port=80 api:app

  # dashboard dash app (standalone)
  app:
    restart: always
    build:
      context: .
      dockerfile: ./build/app/Dockerfile
#    volumes:
#      - bus_assets:/app/app/assets
    ports:
      - 8000:80
    command:
      gunicorn --workers=4 --timeout=120 --threads=1 -b 0.0.0.0:8000 --forwarded-allow-ips="*" app_dash:server

